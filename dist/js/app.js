(()=>{var s=[],L=()=>{s.push([0,0,0,0]),s.push([128,0,0,1]),s.push([0,128,0,2]),s.push([128,128,0,3]),s.push([0,0,128,4]),s.push([128,0,128,5]),s.push([0,128,128,6]),s.push([192,192,192,7]),s.push([128,128,128,8]),s.push([255,0,0,9]),s.push([0,255,0,10]),s.push([255,255,0,11]),s.push([0,0,255,12]),s.push([255,0,255,13]),s.push([0,255,255,14]),s.push([255,255,255,15]),[0,95,135,175,215,255].forEach(n=>{[0,95,135,175,215,255].forEach(a=>{[0,95,135,175,215,255].forEach(t=>{s.push([n,a,t,16+parseInt(""+Math.floor(n/255*5)+Math.floor(a/255*5)+Math.floor(t/255*5),6)])})})}),[8,18,28,38,48,58,68,78,88,98,108,118,128,138,148,158,168,178,188,198,208,218,228,238].forEach(n=>{s.push([n,n,n,232+Math.floor(n/10)])})},H=(n,a)=>[...n].sort((t,o)=>Math.abs(t[0]-a[0])+Math.abs(t[1]-a[1])+Math.abs(t[2]-a[2])-(Math.abs(o[0]-a[0])+Math.abs(o[1]-a[1])+Math.abs(o[2]-a[2]))||t[3]-o[3]).shift()||[0,0,0,0],C=(n,a,t)=>(s.length||L(),(H(s,[n,a,t])||[])[3]),d=C;var i=document.createElement("canvas"),g=i.getContext("2d"),A=(n,a)=>{let t=n.width,o=n.height;if(t>a.maxWidth){let m=t/a.maxWidth;t=a.maxWidth,o=Math.floor(o/m)}if(o>a.maxHeight){let m=o/a.maxHeight;o=a.maxHeight,t=Math.floor(t/m)}i.width=t,i.height=o,g.drawImage(n,0,0,t,o);let c=g.getImageData(0,0,t,o),r=c.data,u="";for(var e=0,h=r.length,l=0;e<h;)if(a.colours==="true")a.unicode?(r[e]===r[e+t*4]&&r[e+1]===r[e+1+t*4]&&r[e+2]===r[e+2+t*4]?u+="\\e[48;2;"+r[e]+";"+r[e+1]+";"+r[e+2]+"m ":o-l==1?u+="\\e[0m\\e[48;2;"+r[e]+";"+r[e+1]+";"+r[e+2]+"m ":u+="\\e[48;2;"+r[e]+";"+r[e+1]+";"+r[e+2]+"m\\e[38;2;"+r[e+t*4]+";"+r[e+1+t*4]+";"+r[e+2+t*4]+"m\u2584",e+=4,e&&!(e/4%t)&&(u+=`\\e[0m
`,e+=4*t,l+=2)):(u+="\\e[48;2;"+r[e]+";"+r[e+1]+";"+r[e+2]+"m  ",e+=4,l++,e&&!(e/4%t)&&(u+=`\\e[0m
`));else if(a.unicode){let m=d(r[e],r[e+1],r[e+2]),f=d(r[e+t*4],r[e+1+t*4],r[e+2+t*4]);m===f?u+="\\e[48;5;"+m+"m ":o-l==1?u+="\\e[0m\\e[48;5;"+m+"m ":u+="\\e[48;5;"+m+"m\\e[38;5;"+f+"m\u2584",e+=4,e&&!(e/4%t)&&(u+=`\\e[0m
`,e+=4*t,l+=2)}else u+="\\e[48;5;"+d(r[e],r[e+1],r[e+2])+"m  ",e+=4,l++,e&&!(e/4%t)&&(u+=`\\e[0m
`);for(;u.match(/(\\e\[[\d;]+m)([▄ ]+)\1/g);)u=u.replace(/(\\e\[[\d;]+m)([▄ ]+)\1/g,"$1$2");return u};var y=(n,a)=>new Promise((t,o)=>{let c=new FileReader,r=new Image;c.addEventListener("load",u=>{let e=u?.target?.result;if(!e){console.error("readImage: No file.",u);return}r.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKAQMAAAC3/F3+AAAAA1BMVEUAAACnej3aAAAAAXRSTlPHReaPdQAAAApJREFUCNdjwAsAAB4AAdpxxYoAAAAASUVORK5CYII=",r.addEventListener("load",()=>{try{t(A(r,a))}catch(h){o(h)}}),r.src=e}),c.readAsDataURL(n)}),b=y;document.addEventListener("click",n=>{let a=n.target;if(!(a instanceof HTMLElement)||!a.matches("a.copy"))return;n.preventDefault();let t=a.dataset.clipboardTarget??null;if(!t)return;let o=document.querySelector(t);!o||navigator.clipboard.writeText(o.innerText)});var p=document.querySelector(".parser .btn"),x=p.querySelector('input[type="file"]'),T=p.querySelector(".spinner-border"),v=Array.from(document.querySelectorAll('input[name="colours"]')),M=document.querySelector('input[name="maxHeight"]'),E=document.querySelector('input[name="maxWidth"]'),I=document.querySelector('input[name="unicode"]'),S=document.querySelector("pre.terminal"),q=document.querySelector("pre.copy-paste code"),R=(n=()=>{})=>{let a=x?.files?.[0];if(!a){n();return}b(a,{colours:v.reduce((t,o)=>o.checked?o.value:t,"256"),maxHeight:parseInt(M.value,10),maxWidth:parseInt(E.value,10),unicode:I.checked}).then(t=>{S.innerText=t,q.innerText=`printf "${t}";`}).catch(t=>{console.error(t)}).finally(()=>{n()})};[...v,M,E,I,x].forEach(n=>n.addEventListener("input",()=>{p.classList.add("disabled"),T.classList.remove("d-none"),R(()=>{p.classList.remove("disabled"),T.classList.add("d-none")})}));})();
//# sourceMappingURL=app.js.map
