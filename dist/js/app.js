(()=>{var P=n=>new Promise((o,e)=>{let a=new FileReader;a.addEventListener("load",c=>{let r=c?.target?.result;if(!r){e(new TypeError("readImage: No file."));return}o(r)}),a.readAsDataURL(n)}),b=n=>new Promise((o,e)=>{let a=new Image;a.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKAQMAAAC3/F3+AAAAA1BMVEUAAACnej3aAAAAAXRSTlPHReaPdQAAAApJREFUCNdjwAsAAB4AAdpxxYoAAAAASUVORK5CYII=",a.addEventListener("load",()=>o(a)),a.addEventListener("error",()=>e(new Error(`Error loading image from URL: '${n}'.`)));try{a.setAttribute("crossOrigin","Anonymous"),a.src=n}catch(c){e(c)}}),E=P;var s=[],R=()=>{s.push([0,0,0,0]),s.push([128,0,0,1]),s.push([0,128,0,2]),s.push([128,128,0,3]),s.push([0,0,128,4]),s.push([128,0,128,5]),s.push([0,128,128,6]),s.push([192,192,192,7]),s.push([128,128,128,8]),s.push([255,0,0,9]),s.push([0,255,0,10]),s.push([255,255,0,11]),s.push([0,0,255,12]),s.push([255,0,255,13]),s.push([0,255,255,14]),s.push([255,255,255,15]),[0,95,135,175,215,255].forEach(n=>{[0,95,135,175,215,255].forEach(o=>{[0,95,135,175,215,255].forEach(e=>{s.push([n,o,e,16+parseInt(""+Math.floor(n/255*5)+Math.floor(o/255*5)+Math.floor(e/255*5),6)])})})}),[8,18,28,38,48,58,68,78,88,98,108,118,128,138,148,158,168,178,188,198,208,218,228,238].forEach(n=>{s.push([n,n,n,232+Math.floor(n/10)])})},w=(n,o)=>[...n].sort((e,a)=>Math.abs(e[0]-o[0])+Math.abs(e[1]-o[1])+Math.abs(e[2]-o[2])-(Math.abs(a[0]-o[0])+Math.abs(a[1]-o[1])+Math.abs(a[2]-o[2]))||e[3]-a[3]).shift()||[0,0,0,0],D=(n,o,e)=>(s.length||R(),(w(s,[n,o,e])||[])[3]),i=D;var g=document.createElement("canvas"),T=g.getContext("2d"),W=(n,o)=>{let e=n.width,a=n.height;if(e>o.maxWidth){let m=e/o.maxWidth;e=o.maxWidth,a=Math.floor(a/m)}if(a>o.maxHeight){let m=a/o.maxHeight;a=o.maxHeight,e=Math.floor(e/m)}g.width=e,g.height=a,T.drawImage(n,0,0,e,a);let c=T.getImageData(0,0,e,a),r=c.data,u="";for(var t=0,q=r.length,d=0;t<q;)if(o.colours==="true")o.unicode?(r[t]===r[t+e*4]&&r[t+1]===r[t+1+e*4]&&r[t+2]===r[t+2+e*4]?u+="\\e[48;2;"+r[t]+";"+r[t+1]+";"+r[t+2]+"m ":a-d==1?u+="\\e[0m\\e[48;2;"+r[t]+";"+r[t+1]+";"+r[t+2]+"m ":u+="\\e[48;2;"+r[t]+";"+r[t+1]+";"+r[t+2]+"m\\e[38;2;"+r[t+e*4]+";"+r[t+1+e*4]+";"+r[t+2+e*4]+"m\u2584",t+=4,t&&!(t/4%e)&&(u+=`\\e[0m
`,t+=4*e,d+=2)):(u+="\\e[48;2;"+r[t]+";"+r[t+1]+";"+r[t+2]+"m  ",t+=4,d++,t&&!(t/4%e)&&(u+=`\\e[0m
`));else if(o.unicode){let m=i(r[t],r[t+1],r[t+2]),v=i(r[t+e*4],r[t+1+e*4],r[t+2+e*4]);m===v?u+="\\e[48;5;"+m+"m ":a-d==1?u+="\\e[0m\\e[48;5;"+m+"m ":u+="\\e[48;5;"+m+"m\\e[38;5;"+v+"m\u2584",t+=4,t&&!(t/4%e)&&(u+=`\\e[0m
`,t+=4*e,d+=2)}else u+="\\e[48;5;"+i(r[t],r[t+1],r[t+2])+"m  ",t+=4,d++,t&&!(t/4%e)&&(u+=`\\e[0m
`);for(;u.match(/(\\e\[[\d;]+m)([▄ ]+)\1/g);)u=u.replace(/(\\e\[[\d;]+m)([▄ ]+)\1/g,"$1$2");return u},x=W;document.addEventListener("click",n=>{let o=n.target;if(!(o instanceof HTMLElement)||!o.matches("a.copy"))return;n.preventDefault();let e=o.dataset.clipboardTarget??null;if(!e)return;let a=document.querySelector(e);!a||navigator.clipboard.writeText(a.innerText)});var p=document.querySelector(".parser .btn"),h=p.querySelector('input[type="file"]'),L=p.querySelector(".spinner-border"),l=document.querySelector('input[type="url"]'),f=document.querySelector(".error-container"),I=f.querySelector(".error-content"),M=Array.from(document.querySelectorAll('input[name="colours"]')),y=document.querySelector('input[name="maxHeight"]'),H=document.querySelector('input[name="maxWidth"]'),C=document.querySelector('input[name="unicode"]'),U=document.querySelector("pre.terminal"),O=document.querySelector("pre.copy-paste code"),A=(n="")=>{if(n===""){f.classList.add("d-none"),I.innerText="";return}f.classList.remove("d-none"),I.innerText=n},S=(n,o=()=>{})=>b(n).then(e=>{let a=x(e,{colours:M.reduce((c,r)=>r.checked?r.value:c,"256"),maxHeight:parseInt(y.value,10),maxWidth:parseInt(H.value,10),unicode:C.checked});U.innerText=a,O.innerText=`printf "${a}";`,A("")}).catch(e=>A(e.message)).finally(()=>o()),B=(n=()=>{})=>{let o=h?.files?.[0],e=l.value;if(o){E(o).then(a=>S(a,n)).catch(a=>A(a.message));return}e&&S(e,n)};h.addEventListener("input",()=>{l.value=""});l.addEventListener("input",n=>{if(!l.reportValidity()||l.value===""){n.stopImmediatePropagation();return}h.value=""});[...M,y,H,C,h,l].forEach(n=>n.addEventListener("input",()=>{p.classList.add("disabled"),l.setAttribute("disabled",""),L.classList.remove("d-none"),B(()=>{p.classList.remove("disabled"),l.removeAttribute("disabled"),L.classList.add("d-none")})}));})();
//# sourceMappingURL=app.js.map
