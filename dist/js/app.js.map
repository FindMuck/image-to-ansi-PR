{
  "version": 3,
  "sources": ["../../src/js/rgbToTerm.ts", "../../src/js/process.ts", "../../src/js/readImage.ts", "../../src/js/app.ts"],
  "sourcesContent": ["declare type Colour = [number, number, number];\ndeclare type TermColour = [...Colour, number];\n\nconst colours: TermColour[] = [],\n  buildColours = (): void => {\n    colours.push([0, 0, 0, 0]);\n    colours.push([128, 0, 0, 1]);\n    colours.push([0, 128, 0, 2]);\n    colours.push([128, 128, 0, 3]);\n    colours.push([0, 0, 128, 4]);\n    colours.push([128, 0, 128, 5]);\n    colours.push([0, 128, 128, 6]);\n    colours.push([192, 192, 192, 7]);\n    colours.push([128, 128, 128, 8]);\n    colours.push([255, 0, 0, 9]);\n    colours.push([0, 255, 0, 10]);\n    colours.push([255, 255, 0, 11]);\n    colours.push([0, 0, 255, 12]);\n    colours.push([255, 0, 255, 13]);\n    colours.push([0, 255, 255, 14]);\n    colours.push([255, 255, 255, 15]);\n\n    [0, 95, 135, 175, 215, 255].forEach((r): void => {\n      [0, 95, 135, 175, 215, 255].forEach((g): void => {\n        [0, 95, 135, 175, 215, 255].forEach((b): void => {\n          colours.push([\n            r,\n            g,\n            b,\n            16 +\n              parseInt(\n                '' +\n                  Math.floor((r / 255) * 5) +\n                  Math.floor((g / 255) * 5) +\n                  Math.floor((b / 255) * 5),\n                6\n              ),\n          ]);\n        });\n      });\n    });\n\n    [\n      8, 18, 28, 38, 48, 58, 68, 78, 88, 98, 108, 118, 128, 138, 148, 158, 168,\n      178, 188, 198, 208, 218, 228, 238,\n    ].forEach((s): void => {\n      colours.push([s, s, s, 232 + Math.floor(s / 10)]);\n    });\n  },\n  best = (candidates: TermColour[], source: Colour): TermColour =>\n    [...candidates]\n      .sort(\n        (x, y): number =>\n          Math.abs(x[0] - source[0]) +\n            Math.abs(x[1] - source[1]) +\n            Math.abs(x[2] - source[2]) -\n            (Math.abs(y[0] - source[0]) +\n              Math.abs(y[1] - source[1]) +\n              Math.abs(y[2] - source[2])) || x[3] - y[3] // prefer lower colour numbers\n      )\n      .shift() || [0, 0, 0, 0];\n\nexport const rgbToTerm = (r: number, g: number, b: number) => {\n  if (!colours.length) {\n    buildColours();\n  }\n\n  return (best(colours, [r, g, b]) || [])[3];\n};\n\nexport default rgbToTerm;\n", "import rgbToTerm from './rgbToTerm';\n\nexport type processOptions = {\n  colours: string;\n  maxHeight: number;\n  maxWidth: number;\n  unicode: boolean;\n};\n\nconst canvas: HTMLCanvasElement = document.createElement('canvas'),\n  context: CanvasRenderingContext2D = canvas.getContext(\n    '2d'\n  ) as CanvasRenderingContext2D;\n\nexport const process = (\n  image: CanvasImageSource,\n  options: processOptions\n): string => {\n  let imageWidth = image.width as number,\n    imageHeight = image.height as number;\n\n  if (imageWidth > options.maxWidth) {\n    const scale = imageWidth / options.maxWidth;\n\n    imageWidth = options.maxWidth;\n    imageHeight = Math.floor(imageHeight / scale);\n  }\n\n  if (imageHeight > options.maxHeight) {\n    const scale = imageHeight / options.maxHeight;\n\n    imageHeight = options.maxHeight;\n    imageWidth = Math.floor(imageWidth / scale);\n  }\n\n  canvas.width = imageWidth;\n  canvas.height = imageHeight;\n\n  context.drawImage(image, 0, 0, imageWidth, imageHeight);\n\n  const imageData = context.getImageData(0, 0, imageWidth, imageHeight),\n    pixelData = imageData.data;\n\n  let content: string = '';\n\n  // Loop over each pixel and invert the color.\n  for (var i = 0, n = pixelData.length, row = 0; i < n; ) {\n    if (options.colours === 'true') {\n      if (options.unicode) {\n        if (\n          pixelData[i] === pixelData[i + imageWidth * 4] &&\n          pixelData[i + 1] === pixelData[i + 1 + imageWidth * 4] &&\n          pixelData[i + 2] === pixelData[i + 2 + imageWidth * 4]\n        ) {\n          content +=\n            '\\\\e[48;2;' +\n            pixelData[i] +\n            ';' +\n            pixelData[i + 1] +\n            ';' +\n            pixelData[i + 2] +\n            'm ';\n        } else {\n          if (imageHeight - row === 1) {\n            content +=\n              '\\\\e[0m\\\\e[48;2;' +\n              pixelData[i] +\n              ';' +\n              pixelData[i + 1] +\n              ';' +\n              pixelData[i + 2] +\n              'm ';\n          } else {\n            content +=\n              '\\\\e[48;2;' +\n              pixelData[i] +\n              ';' +\n              pixelData[i + 1] +\n              ';' +\n              pixelData[i + 2] +\n              'm\\\\e[38;2;' +\n              pixelData[i + imageWidth * 4] +\n              ';' +\n              pixelData[i + 1 + imageWidth * 4] +\n              ';' +\n              pixelData[i + 2 + imageWidth * 4] +\n              'm\u2584';\n          }\n        }\n\n        i += 4;\n\n        if (i && !((i / 4) % imageWidth)) {\n          content += '\\\\e[0m\\n';\n          i += 4 * imageWidth;\n          row += 2;\n        }\n      } else {\n        content +=\n          '\\\\e[48;2;' +\n          pixelData[i] +\n          ';' +\n          pixelData[i + 1] +\n          ';' +\n          pixelData[i + 2] +\n          'm  ';\n        i += 4;\n        row++;\n\n        if (i && !((i / 4) % imageWidth)) {\n          content += '\\\\e[0m\\n';\n        }\n      }\n    } else {\n      if (options.unicode) {\n        const _bg = rgbToTerm(pixelData[i], pixelData[i + 1], pixelData[i + 2]),\n          _fg = rgbToTerm(\n            pixelData[i + imageWidth * 4],\n            pixelData[i + 1 + imageWidth * 4],\n            pixelData[i + 2 + imageWidth * 4]\n          );\n\n        if (_bg === _fg) {\n          content += '\\\\e[48;5;' + _bg + 'm ';\n        } else {\n          if (imageHeight - row === 1) {\n            content += '\\\\e[0m\\\\e[48;5;' + _bg + 'm ';\n          } else {\n            content += '\\\\e[48;5;' + _bg + 'm\\\\e[38;5;' + _fg + 'm\u2584';\n          }\n        }\n\n        i += 4;\n\n        if (i && !((i / 4) % imageWidth)) {\n          content += '\\\\e[0m\\n';\n          i += 4 * imageWidth;\n          row += 2;\n        }\n      } else {\n        content +=\n          '\\\\e[48;5;' +\n          rgbToTerm(pixelData[i], pixelData[i + 1], pixelData[i + 2]) +\n          'm  ';\n        i += 4;\n        row++;\n\n        if (i && !((i / 4) % imageWidth)) {\n          content += '\\\\e[0m\\n';\n        }\n      }\n    }\n  }\n\n  // minimise output, replacing contiguous definitions\n  while (content.match(/(\\\\e\\[[\\d;]+m)([\u2584 ]+)\\1/g)) {\n    content = content.replace(/(\\\\e\\[[\\d;]+m)([\u2584 ]+)\\1/g, '$1$2');\n  }\n\n  return content;\n};\n\nexport default process;\n", "import { process, processOptions } from './process';\n\nexport const readImage = (\n  file: File,\n  options: processOptions\n): Promise<string> => {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader(),\n      image = new Image();\n\n    reader.addEventListener('load', (event) => {\n      const result = event?.target?.result as string;\n\n      if (!result) {\n        console.error('readImage: No file.', event);\n\n        return;\n      }\n\n      image.src =\n        'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKAQMAAAC3/F3+AAAAA1BMVEUAAACnej3aAAAAAXRSTlPHReaPdQAAAApJREFUCNdjwAsAAB4AAdpxxYoAAAAASUVORK5CYII=';\n\n      image.addEventListener('load', () => {\n        try {\n          resolve(process(image, options));\n        } catch (e) {\n          reject(e);\n        }\n      });\n\n      image.src = result;\n    });\n\n    reader.readAsDataURL(file);\n  });\n};\n\nexport default readImage;\n", "import readImage from './readImage';\n\ndeclare var parse: (s: string) => string;\n\ndocument.addEventListener('click', (event): void => {\n  const eventTarget = event.target;\n\n  if (!(eventTarget instanceof HTMLElement)) {\n    return;\n  }\n\n  if (!eventTarget.matches('a.copy')) {\n    return;\n  }\n\n  event.preventDefault();\n\n  const target = eventTarget.dataset.clipboardTarget ?? null;\n\n  if (!target) {\n    return;\n  }\n\n  const contentElement = document.querySelector(target);\n\n  if (!contentElement) {\n    return;\n  }\n\n  navigator.clipboard.writeText((contentElement as HTMLElement).innerText);\n});\n\nconst fileButton = document.querySelector('.parser .btn') as HTMLLabelElement,\n  fileInput = fileButton.querySelector(\n    'input[type=\"file\"]'\n  ) as HTMLInputElement,\n  spinner = fileButton.querySelector('.spinner-border') as HTMLSpanElement,\n  coloursInputs = Array.from(\n    document.querySelectorAll('input[name=\"colours\"]')\n  ) as HTMLInputElement[],\n  maxHeightInput = document.querySelector(\n    'input[name=\"maxHeight\"]'\n  ) as HTMLInputElement,\n  maxWidthInput = document.querySelector(\n    'input[name=\"maxWidth\"]'\n  ) as HTMLInputElement,\n  unicodeInput = document.querySelector(\n    'input[name=\"unicode\"]'\n  ) as HTMLInputElement,\n  terminalPreview = document.querySelector('pre.terminal') as HTMLPreElement,\n  copyPaste = document.querySelector('pre.copy-paste code') as HTMLElement,\n  generate = (done: () => void = () => {}) => {\n    const file = fileInput?.files?.[0];\n\n    if (!file) {\n      done();\n\n      return;\n    }\n\n    readImage(file, {\n      colours: coloursInputs.reduce((value: string, el) => {\n        if (el.checked) {\n          return el.value;\n        }\n\n        return value;\n      }, '256'),\n      maxHeight: parseInt(maxHeightInput.value, 10),\n      maxWidth: parseInt(maxWidthInput.value, 10),\n      unicode: unicodeInput.checked,\n    })\n      .then((ansiEscape) => {\n        terminalPreview.innerText = ansiEscape;\n        copyPaste.innerText = `printf \"${ansiEscape}\";`;\n      })\n      .catch((e) => {\n        console.error(e);\n      })\n      .finally(() => {\n        done();\n      });\n  };\n\n[\n  ...coloursInputs,\n  maxHeightInput,\n  maxWidthInput,\n  unicodeInput,\n  fileInput,\n].forEach((input) =>\n  input.addEventListener('input', () => {\n    fileButton.classList.add('disabled');\n    spinner.classList.remove('d-none');\n\n    generate(() => {\n      fileButton.classList.remove('disabled');\n      spinner.classList.add('d-none');\n    });\n  })\n);\n"],
  "mappings": "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",
  "names": []
}
